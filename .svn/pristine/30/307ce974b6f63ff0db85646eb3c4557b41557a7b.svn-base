@{
    ViewBag.Title = "HOOps Demo Approve";
    var userId = "";
    var partyTypeId = "";
    if (Session["user_au_id"] != null)
    {
        userId = Session["user_au_id"].ToString();
        partyTypeId = Session["party_type_id"].ToString();
    }


}
<style type="text/css">
    .mSuccess {
        border: 3px solid green !important;
        width: 100% !important;
        padding: 3px;
        margin-left: 5px;
        background-color: #90ee90;
        text-align: center;
        font-weight: bold;
    }

    .mWarning {
        border: 3px solid red !important;
        width: 100% !important;
        padding: 3px;
        margin-left: 5px;
        background-color: #ffc0cb;
        text-align: center;
        font-weight: bold;
    }
</style>
<script type="text/javascript">
    var userId = @userId;
    var partyTypeId = @partyTypeId;


    $(document).ready(function () {

        var _rebateList=[];
        var _giftList;

    });
</script>

<div class="col-md-12 widget-body" id="context">
    <div class="row">
        @*<div class="col-md-9">*@
        <div class="row">
            <div class="panel panel-success">
                <div class="panel-heading">Requisition Master</div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="requisition_code">Requistion No</label>
                            </div>
                            <div class="col-md-3">
                                <input id="requisition_code" name="requisition_code" class="k-textbox" disabled />
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">
                                <label for="requisition_date">Requistion Date</label>
                            </div>
                            <div class="col-md-3">
                                <input id="requisition_date" name="requisition_date" style="width: 330px;" disabled />
                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="warehouse_from">From Warehouse</label>
                            </div>
                            <div class="col-md-3">
                                <input id="warehouse_from" name="warehouse_from" disabled />
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">
                                <label for="expected_receiving_date">Expected Receiving Date</label>
                            </div>
                            <div class="col-md-3">
                                <input id="expected_receiving_date" name="expected_receiving_date" disabled />
                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="party_type_id">Channel Type&nbsp;<i class="fa fa-asterisk fieldRequired"></i></label>
                            </div>
                            <div class="col-md-3">
                                <input id="party_type_id" name="party_type_id" disabled />
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">
                                <label for="party_id">Channel Name&nbsp;<i class="fa fa-asterisk fieldRequired"></i></label>
                            </div>
                            <div class="col-md-3">
                                <input id="party_id" name="party_id" disabled />
                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="region_id">Region&nbsp;<i class="fa fa-asterisk fieldRequired"></i></label>
                            </div>
                            <div class="col-md-3">
                                <input id="region_id" name="region_id" disabled />
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">
                                <label for="area_id">Area&nbsp;<i class="fa fa-asterisk fieldRequired"></i></label>
                            </div>
                            <div class="col-md-3">
                                <input id="area_id" name="area_id" disabled />
                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="territory_id">Territory&nbsp;<i class="fa fa-asterisk fieldRequired"></i></label>
                            </div>
                            <div class="col-md-3">
                                <input id="territory_id" name="territory_id" disabled />
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">
                                <label for="address">Dealer Billing Address</label>
                            </div>
                            <div class="col-md-3">
                                <input id="address" name="address" class="k-textbox" disabled />
                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="credit_term">Credit Term(In Days)&nbsp;<i class="fa fa-asterisk fieldRequired"></i></label>
                            </div>
                            <div class="col-md-3">
                                <input id="credit_term" name="credit_term" />
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">
                                <label for="contact_person_mobile">Contact Person Mobile&nbsp;<i class="fa fa-asterisk fieldRequired"></i></label>
                            </div>
                            <div class="col-md-3">
                                <input id="contact_person_mobile" name="contact_person_mobile" class="k-textbox" disabled="" />
                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="company_id">Company&nbsp;<i class="fa fa-asterisk fieldRequired"></i></label>
                            </div>
                            <div class="col-md-3">
                                <input type="text" class="dropdown" name="company_id" id="company_id" disabled>
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">
                                <label for="remarks">Sales Coordinator Remarks</label>
                            </div>
                            <div class="col-md-3">
                                <input id="remarks" name="remarks" class="k-textbox" disabled />

                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>
                    @*<div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2">
                                        <label for="opening_balance">Opening Balance</label>
                                    </div>
                                    <div class="col-md-3">
                                        <input id="opening_balance" name="opening_balance" class="k-textbox" disabled/>
                                        <input type="hidden" id="opening_balance_hidden" name="opening_balance_hidden" disabled />
                                    </div>
                                    <div class="col-md-1"></div>
                                    <div class="col-md-2">
                                        <label for="amount">Order Amount</label>
                                    </div>
                                    <div class="col-md-3">
                                        <input id="amount" name="amount" class="k-textbox" disabled />

                                    </div>
                                    <div class="col-md-1"></div>
                                </div>
                            </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-2">
                                    <label for="credit_limit">Credit Limit</label>
                                </div>
                                <div class="col-md-3">
                                    <input id="credit_limit" name="credit_limit" class="k-textbox" disabled/>
                                </div>
                                <div class="col-md-1"></div>
                                <div class="col-md-2">
                                    <label for="available_credit_limit">Available Credit Limit</label>
                                </div>
                                <div class="col-md-3">
                                    <input id="available_credit_limit" name="available_credit_limit" class="k-textbox" disabled/>
                                </div>
                                <div class="col-md-1"></div>
                            </div>
                        </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2">
                                        <label for="paid_amount" id="paid_amount_lebel">Paid Amount</label>
                                    </div>
                                    <div class="col-md-3">
                                        <input id="paid_amount" name="paid_amount" class="k-textbox" disabled />
                                    </div>
                                    <div class="col-md-1"></div>
                                    <div class="col-md-2">
                                        <label for="remaining_balance">Remaining Balance</label>
                                    </div>
                                    <div class="col-md-3">
                                        <input id="remaining_balance" name="remaining_balance" class="k-textbox" disabled />
                                    </div>
                                    <div class="col-md-1"></div>
                                </div>
                            </div>*@
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="accounts_remarks">Accounts Remark</label>
                            </div>
                            <div class="col-md-3">
                                <input id="accounts_remarks" name="accounts_remarks" class="k-textbox" disabled />
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">
                                <label for="recommendation">HOS Recommendation</label>
                            </div>
                            <div class="col-md-3">
                                <input id="recommendation" name="recommendation" class="k-textbox" disabled />
                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>
                    @*<div class="row">
                            <div class="col-md-12">
                                <div class="col-md-2">
                                    <label for="payment_verify">Payment Status</label>
                                </div>
                                <div class="col-md-3">
                                    <div id="payment_verify" class=""></div>
                                </div>
                                <div class="col-md-1"></div>
                                <div class="col-md-2">
                                    <label for="credit_limit_status">Credit Limit Status</label>
                                </div>
                                <div class="col-md-3">
                                    <div id="credit_limit_status" class=""></div>
                                </div>
                                <div class="col-md-1"></div>
                            </div>
                        </div>*@
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="operation_remarks">Operation Remarks</label>
                            </div>
                            <div class="col-md-3">
                                <input id="operation_remarks" name="operation_remarks" class="k-textbox" placeholder="here type operation remarks" />
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">

                            </div>
                            <div class="col-md-3">

                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>

                    @*<div class="row" style="visibility: hidden;">
                            <div class="col-md-12">
                                <div class="col-md-2">
                                    <input id="txtpId" name="txtpId" class="k-textbox" disabled />
                                </div>
                                <div class="col-md-3">

                                </div>
                                <div class="col-md-1"></div>
                                <div class="col-md-2">

                                </div>
                                <div class="col-md-3">
                                    <input id="txtcId" name="txtcId" class="k-textbox" disabled />
                                </div>
                                <div class="col-md-1"></div>
                            </div>
                        </div>*@
                </div>
            </div>
        </div>
        <div class="row">
            <div class="panel panel-success">
                <div class="panel-heading">Accounts</div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="amount">Order Amount</label>
                            </div>
                            <div class="col-md-3">
                                <input id="amount" name="amount" class="k-textbox" disabled />
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">
                                <label for="paid_amount" id="paid_amount_lebel">Paid Amount</label>
                            </div>
                            <div class="col-md-3">
                                <input id="paid_amount" name="paid_amount" class="k-textbox" disabled />
                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="opening_balance">Opening Balance</label>
                            </div>
                            <div class="col-md-3" id="testhala">
                                <input id="opening_balance" name="opening_balance" class="k-textbox" disabled />
                                <input type="hidden" id="opening_balance_hidden" name="opening_balance_hidden" disabled />
                            </div>
                            <div class="col-md-1">
                            </div>
                            <div class="col-md-2">
                                <label for="current_requisition_balance">Current Requisition Balance</label>
                            </div>
                            <div class="col-md-3">
                                <input id="current_requisition_balance" name="current_requisition_balance" class="k-textbox" disabled />
                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="credit_limit">Credit Limit</label>
                            </div>
                            <div class="col-md-3">
                                <input id="credit_limit" name="credit_limit" class="k-textbox" disabled />
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">
                                <label for="remaining_balance">Total Balance</label>
                            </div>
                            <div class="col-md-3">
                                <input id="remaining_balance" name="remaining_balance" class="k-textbox" disabled />
                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="available_credit_limit">Available Credit Limit</label>
                            </div>
                            <div class="col-md-3">
                                <input id="available_credit_limit" name="available_credit_limit" class="k-textbox" disabled />
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">

                            </div>
                            <div class="col-md-3">

                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <label for="payment_verify">Payment Status</label>
                            </div>
                            <div class="col-md-3">
                                <div id="payment_verify" class=""></div>
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-2">
                                <label for="credit_limit_status">Credit Limit Status</label>
                            </div>
                            <div class="col-md-3">
                                <div id="credit_limit_status" class=""></div>
                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="panel panel-success">
                <div class="panel-heading">Stocked And Booked Quantity</div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-1">
                                <label for="stock_quantity">Stock Quantity</label>
                            </div>
                            <div class="col-md-2">
                                <input id="stock_quantity" name="stock_quantity" class="k-textbox" disabled />
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-1">
                                <label for="booked_quantity">Booked Quantity</label>
                            </div>
                            <div class="col-md-2">
                                <input id="booked_quantity" name="booked_quantity" class="k-textbox" disabled />

                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-1">
                                <label for="available_quantity">Available Qty</label>
                            </div>
                            <div class="col-md-2">
                                <input id="available_quantity" name="available_quantity" class="k-textbox" disabled />
                            </div>
                            <div class="col-md-1"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="panel panel-success">
                <div class="panel-heading">Product List</div>
                <div class="panel-body">
                    <div id="RequisitionDetailsGrid"></div>

                </div>
            </div>
        </div>

        @*</div>*@

        <div class="col-md-3" style="visibility: hidden;">
            <div class="panel panel-success">
                <div class="panel-heading">Available Promotions</div>
                <div class="panel-body" id="available_promotions">

                </div>
            </div>
        </div>
    </div>


    <div class="row">
        <div class="group-box">
            <div class="row">
                <div class="col-md-12">
                    <input type="button" class="k-button" id="btnSaveInvoice" name="btnSaveInvoice" value="Approve & Forward to WH" />
                </div>
            </div>
        </div>
    </div>
</div>
<p>&nbsp;</p>
<!--Javascript and Ajax to Submit the Form-->
<script type="text/javascript">
    //date time picker
    $(document).ready(function () {

        var pId;
        var cId;
        var pCatId;

        var colId;
        var pVersionId;

        var colIdInColorChange;
        var pVersionIdInColorChange;
        var pvIdInVersionChange;
        var avlCLimit;

        //$('#context').addClass('animated zoomIn');


        // load dropdowns
        $("#warehouse_from").kendoComboBox({
            autoBind: true,
            placeholder: "--- Select Warehouse ---",
            dataTextField: "warehouse_name",
            dataValueField: "warehouse_id",
            dataSource: {
                type: "json",
                transport: {
                    read: {
                        url: "@UrlConfig.Action("GetAllWarehouses", "Warehouse")"
                    }
                }
            }

        });

        $("#party_type_id").kendoComboBox({
            autoBind: true,
            placeholder: "--- Select Party Type ---",
            dataTextField: "party_type_name",
            dataValueField: "party_type_id",
            dataSource: {
                type: "json",
                transport: {
                    read: {
                        url: "@UrlConfig.Action("GetClientPartyTypes", "PartyType")"
                    }
                }
            }
        });
        $("#party_id").kendoComboBox({
            autoBind: true,
            placeholder: "--- Select Party ---",
            dataTextField: "party_name",
            dataValueField: "party_id",
            dataSource: {
                type: "json",
                transport: {
                    read: {
                        url: "@UrlConfig.Action("GetAllParty", "Party")"
                    }
                }
            }
        });
        //$("#party_id").data("kendoComboBox").enable(false);

        $("#region_id").kendoComboBox({
            autoBind: true,
            placeholder: "--- Select Region ---",
            dataTextField: "region_name",
            dataValueField: "region_id",
            dataSource: {
                type: "json",
                transport: {
                    read: {
                        url: "@UrlConfig.Action("GetAllRegions", "Region")"
                    }
                }
            }
        });

        //area dropdown by region_wise
        $("#area_id").kendoComboBox({
            autoBind: false,
            //cascadeFrom: "region_id",
            placeholder: "--- Select Area ---",
            dataTextField: "area_name",
            dataValueField: "area_id",
            dataSource: {
                type: "json",
                transport: {
                    read: {
                        url: "@UrlConfig.Action("GetAllArea", "Area")"
                    }
                }
            }
        });
        //territory dropdown
        $("#territory_id").kendoComboBox({
            autoBind: false,
            placeholder: "--- Select Territory ---",
            dataTextField: "territory_name",
            dataValueField: "territory_id",
            dataSource: {
                type: "json",
                transport: {
                    read: {
                        url: "@UrlConfig.Action("GetAllTerritory", "Territory")"
                    }
                }
            }
        });
        //Company
        $("#company_id").kendoComboBox({
            autoBind: false,
            placeholder: "--- Select Company ---",
            dataTextField: "company_name",
            dataValueField: "company_id",
            dataSource: {
                type: "json",
                transport: {
                    read: {
                        url: "@UrlConfig.Action("GetAllCompany", "Company")"
                    }
                }
            }
        }).data("kendoComboBox");

        //14.05.2017
        function getCreditLimit(partId) {
            $.ajax({
                type: "GET",
                url: "@UrlConfig.Action("GetPartyCreditLimit", "Party")",
                data: { party_id: partId },
                dataType: "json",
                async: false,
                success: function (data) {
                    Loading(false);
                    $("#credit_limit").val(data);

                }
            });
        }
        function getopeningBalance(partId) {
            $.ajax({
                type: "GET",
                url: "@UrlConfig.Action("GetPartyOpeningBalance", "PartyJournal")",
                data: { party_id: partId },//Passing parameter
                dataType: "json",
                async: false,//14.05.2017
                success: function (data) {
                    Loading(false);
                    $("#opening_balance_hidden").val(-data);
                    //$("#opening_balance").val(data);
                    //if (data > 0) {
                    //    $("#available_credit_limit").val(data);
                    //} else {
                    //    var openingBalance = parseFloat(data);
                    //    var credit_limit = $("#credit_limit").val();
                    //    var currentLimit = parseFloat(credit_limit) - parseFloat(openingBalance);
                    //    $("#available_credit_limit").val(currentLimit);
                    //}
                }
            });

        }
        function getPaidAmtForthisRequisition(requisitionMasterId) {
            $.ajax({
                type: "GET",
                url: "@UrlConfig.Action("GetPaidAmtofRequisition", "Requisition")",
                data: { requisition_master_id: requisitionMasterId },
                dataType: "json",
                success: function (data) {
                    Loading(false);
                    $("#paid_amount").val(data);
                    var paidAmt = +data;
                    var opBalanceHid = +$("#opening_balance_hidden").val();
                    var opBalance = 0-opBalanceHid + paidAmt;
                    $("#opening_balance").val(opBalance);
                    //if (opBalance > 0) {
                    //    $("#available_credit_limit").val(opBalance);
                    //    avlCLimit = opBalance;
                    //} else {
                    //    var credit_limit = +$("#credit_limit").val();
                    //    var currentLimit = credit_limit - opBalance;
                    //    $("#available_credit_limit").val(currentLimit);
                    //    avlCLimit = currentLimit;
                    //}
                }
            });

        }
        //14.05.2017
        function paymetnStatus(requisitionMasterId) {
            $.ajax({
                type: "GET",
                url: "@UrlConfig.Action("GetPaymentStatus", "Requisition")",
                data: { requisition_master_id: requisitionMasterId },
                dataType: "json",
                success: function (data) {
                    Loading(false);
                    //$("#payment_verify").val(data);
                    $("#payment_verify").text(data);
                    if (data == "PAYMENT VERIFIED") {
                        $("#payment_verify").addClass("mSuccess");
                    }
                    if (data == "WITHOUT PAYMENT") {
                        $("#payment_verify").addClass("mWarning");
                    }
                }
            });
        }

        function myFunction() {
            var sampleData = [];
            //get master and details information----------------
            var requisition_master_id = '@ViewBag.requisition_master_id';
            Loading(true);
            $.ajax({
                type: "POST",
                url: "@UrlConfig.Action("GetRequisitionById", "Requisition")",
                data: {
                    requisition_master_id: requisition_master_id
                },
                dataType: "json",
                success: function (data) {
                    Loading(false);
                    $("#requisition_code").val(data.RequisitionMasterData.requisition_code);
                    //$("#requisition_date").val(kendo.toString(kendo.parseDate(data.RequisitionMasterData.requisition_date, "yyyy-MM-dd"), "yyyy/MM/dd"));
                    $("#requisition_date").val(data.RequisitionMasterData.requisition_date);
                    $('#warehouse_from').data("kendoComboBox").value(data.RequisitionMasterData.warehouse_from);
                    $("#expected_receiving_date").val(kendo.toString(kendo.parseDate(data.RequisitionMasterData.expected_receiving_date, "yyyy-MM-dd"), "yyyy/MM/dd"));
                    $("#amount").val(data.RequisitionMasterData.amount);
                    $("#remarks").val(data.RequisitionMasterData.remarks);
                    //$("#credit_limit").val(data.RequisitionMasterData.credit_limit);
                    $("#party_type_id").data("kendoComboBox").value(data.RequisitionMasterData.party_type_id);
                    $("#party_id").data("kendoComboBox").value(data.RequisitionMasterData.party_id);
                    $("#region_id").data("kendoComboBox").value(data.RequisitionMasterData.region_id);
                    $("#area_id").data("kendoComboBox").value(data.RequisitionMasterData.area_id);
                    $("#territory_id").data("kendoComboBox").value(data.RequisitionMasterData.territory_id);

                    $("#credit_term").val(kendo.toString(kendo.parseDate(data.RequisitionMasterData.credit_term, "yyyy-MM-dd"), "yyyy/MM/dd"));
                    $("#contact_person_mobile").val(data.RequisitionMasterData.contact_person_mobile);
                    $("#address").val(data.RequisitionMasterData.address);
                    $('#company_id').data("kendoComboBox").value(data.RequisitionMasterData.company_id);
                    $("#accounts_remarks").val(data.RequisitionMasterData.accounts_remarks);
                    $("#recommendation").val(data.RequisitionMasterData.sales_head_recommendation);

                    getCreditLimit(data.RequisitionMasterData.party_id);
                    getPaidAmtForthisRequisition('@ViewBag.requisition_master_id');
                    getopeningBalance(data.RequisitionMasterData.party_id);

                    paymetnStatus(data.RequisitionMasterData.requisition_master_id);

                    var remainingBalance = 0;
                    var openingBalance = 0;
                    var openingBalanceHidden = 0;
                    var paidAmount = 0;
                    var orderAmount = 0;
                    var currentRequisitionBalance = 0;
                    var totalBalance = 0;
                    var creditLimit = 0;
                    var availableCreditLimit = 0;

                    openingBalance = +$("#opening_balance").val();
                    openingBalanceHidden = +$("#opening_balance_hidden").val();
                    paidAmount = +$("#paid_amount").val();
                    orderAmount = +$("#amount").val();

                    remainingBalance = openingBalanceHidden-orderAmount;
                    $("#remaining_balance").val(0-remainingBalance);

                    var orderAmt = $("#amount").val();

                    //current requisition balance
                    currentRequisitionBalance = orderAmt - paidAmount;
                    $("#current_requisition_balance").val(currentRequisitionBalance);

                    //available credit limit
                    totalBalance = +$("#remaining_balance").val();
                    creditLimit = +$("#credit_limit").val();

                    if ($("#remaining_balance").val() > 0) {
                        availableCreditLimit = creditLimit - totalBalance;
                        $("#available_credit_limit").val(availableCreditLimit);
                    } else {
                        $("#available_credit_limit").val(creditLimit);
                    }

                    var avlCrLimit = avlCLimit;
                    if(availableCreditLimit<0){
                        $("#credit_limit_status").text("EXCEED CREDIT LIMIT");
                        $("#credit_limit_status").addClass('mWarning');
                        //$('#verfy').show();
                    } else {
                        $("#credit_limit_status").text("CREDIT LIMIT AVAILABLE");
                        $("#credit_limit_status").addClass("mSuccess");
                    }

                    for (var i = 0; i < data.RequisitionDetailsList.length; i++) {
                        var requisitionDetails = {
                            requisition_details_id: data.RequisitionDetailsList[i].requisition_details_id,
                            product_id: data.RequisitionDetailsList[i].product_id,
                            product_name: data.RequisitionDetailsList[i].product_name,
                            requisition_master_id:data.RequisitionDetailsList[i].requisition_master_id,
                            color_id: data.RequisitionDetailsList[i].color_id,
                            color_name: data.RequisitionDetailsList[i].color_name,

                            brand_id: data.RequisitionDetailsList[i].brand_id,
                            brand_name: data.RequisitionDetailsList[i].brand_name,
                            product_category_id: data.RequisitionDetailsList[i].product_category_id,
                            product_category_name: data.RequisitionDetailsList[i].product_category_name,

                            unit_id: data.RequisitionDetailsList[i].unit_id,
                            unit_name: data.RequisitionDetailsList[i].unit_name,
                            price: data.RequisitionDetailsList[i]. price,
                            quantity: data.RequisitionDetailsList[i].quantity,
                            amount: data.RequisitionDetailsList[i].amount,
                            line_total: data.RequisitionDetailsList[i].line_total,
                            //is_live_dummy: data.RequisitionDetailsList[i].is_live_dummy,
                            product_version_id: data.RequisitionDetailsList[i].product_version_id,
                            product_version_name: data.RequisitionDetailsList[i].product_version_name,
                            has_serial: data.RequisitionDetailsList[i].has_serial
                        };
                        sampleData.push(requisitionDetails);
                    }
                    //console.log('sampleData: in MyFunction:');
                    //console.log(sampleData);

                    //productList Grid---------------------

                    var sampleDataNextID = sampleData.length + 1;

                    function getIndexById(id) {
                        var idx,
                            l = sampleData.length;

                        for (var j = 0; j < l; j++) {
                            if (sampleData[j].requisition_details_id == id) {
                                return j;
                            }
                        }
                        return null;
                    }

                    // custom logic end
                    var dataSource = new kendo.data.DataSource({
                        transport: {
                            read: function (e) {
                                // on success
                                e.success(sampleData);
                                //console.log(sampleData);
                            },
                            create: function (e) {
                                // assign an ID to the new item
                                e.data.requisition_details_id = sampleDataNextID++;
                                // save data item to the original datasource

                                var gridData = sampleData;
                                var totalNumber = gridData.length;
                                var count = 0;

                                for (var i = 0; i < totalNumber; i++) {
                                    var productId = gridData[i].product_id;
                                    var colorId = gridData[i].color_id;
                                    var productVersionId=gridData[i].product_version_id;
                                    if (e.data.product_id === productId && e.data.color_id === colorId && e.data.product_version_id === productVersionId) {
                                        count++;
                                    }
                                }
                                if (count > 0) {
                                    sweetAlert("Sorry...", "Selected Product is Duplicate !!!", "warning");
                                    e.preventDefault();
                                    return false;
                                } else {
                                    sampleData.push(e.data);
                                    e.success(e.data);
                                    //getRebateAndGiftInfo();
                                    console.log(sampleData);
                                    return true;
                                }

                            },
                            update: function (e) {
                                // locate item in original datasource and update it
                                sampleData[getIndexById(e.data.requisition_details_id)] = e.data;
                                //getRebateAndGiftInfo();
                                e.success();

                            },
                            destroy: function (e) {
                                // locate item in original datasource and remove it
                                var requisitionDetailsId=e.data.requisition_details_id;

                                sampleData.splice(getIndexById(e.data.requisition_details_id), 1);

                                $.ajax({
                                    type: "GET",
                                    url: "@UrlConfig.Action("DeleteRequisitionDetails", "Requisition")",
                                    data: {
                                        requisition_details_id: requisitionDetailsId
                                    },
                                    dataType: "json",
                                    contentType: "application/json",
                                    success: function (data) {
                                        Loading(false);
                                        console.log(data);
                                        if (data.output === "success") {
                                            swal("Success", data.msg, "success");
                                            return false;
                                        } else {
                                            swal("Exception", data.msg, "error");
                                            return false;
                                        }
                                    }
                                });

                                // on success
                                e.success();
                                var entityGrid = $("#RequisitionDetailsGrid").data("kendoGrid");
                                var gridData = entityGrid.dataSource.data();
                                var totalNumber = gridData.length;

                                var amount = 0;

                                for (var i = 0; i < totalNumber; i++) {

                                    amount += +parseFloat(gridData[i].line_total).toFixed(2);
                                }
                                $("#amount").val(amount);
                            }
                        },
                        error: function (e) {
                            // handle data operation error
                            alert("Status: " + e.status + "; Error message: " + e.errorThrown);
                        },
                        pageSize: 10,
                        batch: false,
                        schema: {
                            model: {
                                id: "requisition_details_id",
                                fields: {
                                    requisition_details_id: { editable: false, nullable: true },
                                    requisition_master_id:{ field: "requisition_master_id", type: "integer" },
                                    product_id: { field: "product_id", type: "integer" },
                                    product_name: { type: "string" },
                                    product_category_id: { field: "product_category_id", type: "integer" },
                                    product_category_name: { type: "string" , editable: false},
                                    brand_id: { field: "brand_id", type: "integer" },
                                    brand_name: { type: "string", editable: false },
                                    unit_id: { field: "unit_id", type: "integer" },
                                    unit_name: { type: "string", editable: false },
                                    color_id: { field: "color_id", type: "integer" },
                                    color_name: { type: "string" },
                                    product_version_id: { field: "product_version_id", type: "integer" },
                                    product_version_name: { type: "string" },
                                    quantity: { type: "number" },
                                    //is_live_dummy: {type: "boolean"},
                                    price: { type: "number" },
                                    amount: { type: "string", editable: true },
                                    line_total: { type: "string", editable: true },
                                    has_serial: {type: "boolean"}
                                }
                            }
                        }
                    });

                    $("#RequisitionDetailsGrid").kendoGrid({
                        dataSource: dataSource, //
                        pageable: true,
                        toolbar: ["create"],
                        selectable: true,
                        save: function (data) {

                            var tempAmount = +data.model.quantity * +data.model.price;
                            data.model.set("line_total", tempAmount);


                            var entityGrid = $("#RequisitionDetailsGrid").data("kendoGrid");
                            var gridData = entityGrid.dataSource.data();
                            var totalNumber = gridData.length;

                            var amount = 0;

                            for (var i = 0; i < totalNumber; i++) {
                                amount += +parseFloat(gridData[i].line_total).toFixed(2);
                            }

                            $("#amount").val(amount);//

                        },
                        edit: function (e) {

                            $('input[name="line_total"]').attr('readonly', 'readonly');//

                        },
                        cancel: function(data) {

                            var tempAmount = +data.model.quantity * +data.model.price;
                            data.model.set("lineTotal", tempAmount);


                            var gridData = sampleData;
                            var totalNumber = gridData.length;


                            console.log(sampleData);

                        },
                        columns: [
                            { field: "product_category_id", title: "Product Category", template: "#= product_category_name #", editor: productCategoryDropDownEditor, width: "110px" },
                            { field: "product_id", title: "Product", template: "#= product_name #", editor: productDropDownEditor, width: "120px" },
                            { field: "color_id", title: "Color", template: "#= color_name #", editor: colorDropDownEditor, width: "50px" },
                            { field: "product_version_id", title: "Version", template: "#= product_version_name #", editor: productVersionDropDownEditor, width: "50px" },
                            { field: "quantity", title: "Quantity", width: "50px" },
                            //{ field: "is_live_dummy", title: "Live Dummy?", width: "50px"},
                            { field: "price", title: "Demo Price", width: "50px" },
                            { field: "line_total", title: "Total Amt", width: "50px" },
                            { command: ["edit", "destroy"], title: "&nbsp;", width: "110px" }
                        ],
                        editable: "inline"
                    });

                    //Sales gift Items(03.10.2016)//////////////////////////////////////////
                    var sampleDataGift = [];

                    // custom logic start

                    var sampleDataNextIDGift = sampleDataGift.length + 1;

                    function getIndexByIdGift(id) {
                        var idx,
                            l = sampleDataGift.length;

                        for (var j = 0; j < l; j++) {
                            if (sampleDataGift[j].requisition_details_id == id) {
                                return j;
                            }
                        }
                        return null;
                    }

                    //var dataSourceGift = new kendo.data.DataSource({
                    //    transport: {
                    //        read: function (e) {
                    //            e.success(sampleDataGift);
                    //        },
                    //        create: function (e) {

                    //            // assign an ID to the new item
                    //            e.data.requisition_details_id = sampleDataNextIDGift++;
                    //            // save data item to the original datasource

                    //            var gridData = sampleDataGift;
                    //            var totalNumber = gridData.length;
                    //            var count = 0;

                    //            for (var i = 0; i < totalNumber; i++) {
                    //                var productId = gridData[i].product_id;
                    //                var colorId = gridData[i].color_id;
                    //                if (e.data.product_id === productId && e.data.color_id === colorId) {
                    //                    count++;
                    //                }
                    //            }
                    //            if (count > 0) {
                    //                sweetAlert("Sorry...", "Selected Product is Duplicate !!!", "warning");
                    //                //e.preventDefault();
                    //                return false;
                    //            } else {
                    //                sampleDataGift.push(e.data);
                    //                e.success(e.data);
                    //                return true;
                    //            }


                    //        },
                    //        update: function (e) {
                    //            // locate item in original datasource and update it
                    //            sampleDataGift[getIndexByIdGift(e.data.requisition_details_id)] = e.data;
                    //            e.success();
                    //        },
                    //        destroy: function (e) {
                    //            // locate item in original datasource and remove it
                    //            sampleDataGift.splice(getIndexByIdGift(e.data.requisition_details_id), 1);
                    //            // on success
                    //            e.success();
                    //            var entityGrid = $("#giftitemlist").data("kendoGrid");
                    //            var gridData = entityGrid.dataSource.data();
                    //            var totalNumber = gridData.length;
                    //        }
                    //    },
                    //    error: function (e) {
                    //        // handle data operation error
                    //        alert("Status: " + e.status + "; Error message: " + e.errorThrown);
                    //    },
                    //    pageSize: 10,
                    //    batch: false,
                    //    schema: {
                    //        model: {
                    //            id: "requisition_details_id",
                    //            fields: {
                    //                requisition_details_id: { editable: false, nullable: true },
                    //                product_id: { field: "product_id", type: "integer" },
                    //                product_name: { type: "string" },
                    //                product_category_id: { field: "product_category_id", type: "integer" },
                    //                product_category_name: { type: "string" , editable: false},
                    //                unit_id: { field: "unit_id", type: "integer" },
                    //                unit_name: { type: "string" },
                    //                brand_id: { field: "brand_id", type: "integer" },
                    //                brand_name: { type: "string", editable: false },
                    //                quantity: { type: "number" },
                    //                color_id: { field: "color_id", type: "integer" },
                    //                color_name: { type: "string" },
                    //                is_live_dummy: {type: "boolean"},
                    //                price: { type: "number" },
                    //                line_total: { type: "string" }

                    //            }
                    //        }
                    //    }
                    //});


                    //$("#giftitemlist").kendoGrid({
                    //    dataSource: dataSourceGift,
                    //    pageable: true,
                    //    toolbar: ["create"],
                    //    selectable: true,
                    //    save: function (data) {

                    //        var amount = 0;
                    //        //var tempAmount = +data.model.quantity * +data.model.price;
                    //        //data.model.set("line_total", tempAmount);
                    //        var entityGrid = $("#giftitemlist").data("kendoGrid");
                    //        var gridData = entityGrid.dataSource.data();
                    //        var totalNumber = gridData.length;

                    //        //for (var i = 0; i < totalNumber; i++) {
                    //        //    amount += +parseFloat(gridData[i].line_total).toFixed(2);
                    //        //}

                    //        //$("#amount").val(amount);

                    //    },

                    //    cancel: function(data) {
                    //        //var tempAmount = +data.model.quantity * +data.model.price;
                    //        //data.model.set("line_total", tempAmount);

                    //        var gridData = sampleDataGift;
                    //        var totalNumber = gridData.length;
                    //        console.log(sampleDataGift);

                    //    },
                    //    columns: [
                    //        { field: "product_id", title: "Product", template: "#= product_name #", editor: productDropDownEditorGift, width: "50px" },
                    //        { field: "color_id", title: "Color", template: "#= color_name #", editor: colorDropDownEditorGift, width: "50px" },
                    //        { field: "quantity", title: "Quantity", width: "50px" },
                    //        //{ field: "price", title: "Price", width: "50px" },
                    //        //{ field: "line_total", title: "Line Total", width: "50px" },
                    //        { command: ["edit", "destroy"], title: "&nbsp;", width: "110px" }
                    //    ],
                    //    editable: "inline"
                    //});

                    //template for product comboBox
                    @*function productDropDownEditorGift(container, options) {
                        jQuery('<input required data-text-field="product_name" data-value-field="product_id" data-bind="value:' + options.field + '"/>')
                            .appendTo(container)

                            .kendoComboBox({
                                autoBind: true,
                                placeholder: "-Select-",
                                dataSource: {
                                    transport: {
                                        read: {
                                            url: "@UrlConfig.Action("GetAllProducts", "Product")",
                                        type: "GET"
                                    }
                                }

                            },

                            change: function (e) {
                                var dataItem = this.dataItem(e.item);

                                console.log(dataItem.product_name);
                                var grid = $("#giftitemlist").data("kendoGrid");
                                var sel = grid.select();
                                var sel_idx = sel.index();
                                var gridData = grid.dataSource.data();
                                gridData[sel_idx].product_id = dataItem.product_id,
                                gridData[sel_idx].product_name = dataItem.product_name;
                                gridData[sel_idx].color_id = dataItem.color_id,
                                gridData[sel_idx].color_name = dataItem.color_name;
                                gridData[sel_idx].unit_id = dataItem.unit_id;
                                gridData[sel_idx].unit_name = dataItem.unit_name;
                                gridData[sel_idx].brand_id = dataItem.brand_id;
                                gridData[sel_idx].brand_name = dataItem.brand_name;
                                gridData[sel_idx].product_category_id = dataItem.product_category_id;
                                gridData[sel_idx].product_category_name = dataItem.product_category_name;

                                if (partyTypeId==2) {
                                    gridData[sel_idx].price = dataItem.md_price;
                                }
                                if (partyTypeId==3) {
                                    gridData[sel_idx].price = dataItem.bs_price;
                                }

                            }
                    });
                }*@

                    //template for color comboBox
                    @*function colorDropDownEditorGift(container, options) {
                        jQuery('<input required data-text-field="color_name" data-value-field="color_id" data-bind="value:' + options.field + '"/>')
                            .appendTo(container)

                            .kendoComboBox({
                                autoBind: true,
                                placeholder: "-Select-",
                                dataSource: {
                                    transport: {
                                        read: {
                                            url: "@UrlConfig.Action("GetAllColors", "Color")",
                                        type: "GET"
                                    }
                                }

                            },

                            change: function (e) {
                                var dataItem = this.dataItem(e.item);

                                console.log(dataItem.product_name);
                                var grid = $("#giftitemlist").data("kendoGrid");
                                var sel = grid.select();
                                var sel_idx = sel.index();
                                var gridData = grid.dataSource.data();
                                gridData[sel_idx].color_id = dataItem.color_id,
                                gridData[sel_idx].color_name = dataItem.color_name;


                            }
                    });
                }*@
                    //////////////////////////////////////////////////////////////////
                    //template for product category comboBox
                    function productCategoryDropDownEditor(container, options) {
                        jQuery('<input id="productCategoryId"  data-text-field="product_category_name" data-value-field="product_category_id" data-bind="value:' + options.field + '"/>')
                            .appendTo(container)
                            .kendoComboBox({
                                autoBind: false,
                                placeholder: "-Select-",
                                dataSource: {
                                    transport: {
                                        read: {
                                            url: "@UrlConfig.Action("GetAllProductCategories", "ProductCategory")",
                                            type: "GET"
                                        }
                                    }

                                },

                                change: function(e) {
                                    var dataItem = this.dataItem(e.item);
                                    pCatId = dataItem.product_category_id;

                                    //console.log("MOHIUDDIN");
                                    //console.log(pCatId);
                                    var grid = $("#RequisitionDetailsGrid").data("kendoGrid");
                                    var sel = grid.select();
                                    var sel_idx = sel.index();
                                    var gridData = grid.dataSource.data();
                                    gridData[sel_idx].product_category_id = dataItem.product_category_id;
                                    gridData[sel_idx].product_category_name = dataItem.product_category_name;

                                }
                            });
                    }

                    //template for product comboBox
                    function productDropDownEditor(container, options) {
                        jQuery('<input id="productId" required data-text-field="product_name" data-value-field="product_id" data-bind="value:' + options.field + '"/>')
                            .appendTo(container)
                            .kendoComboBox({
                                autoBind: false,
                                cascadeFrom: "productCategoryId", //27.04.2017
                                placeholder: "-Select-",
                                dataSource: {
                                    transport: {
                                        read: {
                                            @*url: "@UrlConfig.Action("GetAllProducts", "Product")",*@
                                            url: "@UrlConfig.Action("GetProductCategorywiseProduct", "Product")",
                                            type: "GET"
                                        }
                                    }

                                },

                                change: function (e) {
                                    var dataItem = this.dataItem(e.item);
                                    pId = dataItem.product_id;

                                    console.log(dataItem.product_name);
                                    var grid = $("#RequisitionDetailsGrid").data("kendoGrid");
                                    var sel = grid.select();
                                    var sel_idx = sel.index();
                                    var gridData = grid.dataSource.data();
                                    gridData[sel_idx].product_id = dataItem.product_id,
                                    gridData[sel_idx].product_name = dataItem.product_name;
                                    gridData[sel_idx].unit_id = dataItem.unit_id;
                                    gridData[sel_idx].unit_name = dataItem.unit_name;
                                    gridData[sel_idx].brand_id = dataItem.brand_id;
                                    gridData[sel_idx].brand_name = dataItem.brand_name;
                                    gridData[sel_idx].product_category_id = dataItem.product_category_id;
                                    gridData[sel_idx].product_category_name = dataItem.product_category_name;
                                    gridData[sel_idx].has_serial = dataItem.has_serial;
                                    $.ajax({
                                        type: "GET",
                                        url: "@UrlConfig.Action("GetProductsWiseFirstColorVersionForDemo", "Product")",
                                        data: {
                                            product_id: pId
                                        },
                                        dataType: "json",
                                        contentType: "application/json",
                                        success: function (data) {
                                            gridData[sel_idx].color_id =data.color_id;
                                            $("#colorId").data("kendoComboBox").value(gridData[sel_idx].color_id);

                                            if (pCatId == 3) {
                                                colId = 0;
                                            } else {
                                                colId = gridData[sel_idx].color_id;
                                            }

                                            gridData[sel_idx].color_name = data.color_name;
                                            gridData[sel_idx].product_version_id =data.product_version_id;

                                            if (pCatId == 3) {
                                                pVersionId = 0;

                                            } else {
                                                pVersionId = gridData[sel_idx].product_version_id;
                                            }

                                            gridData[sel_idx].product_version_name = data.product_version_name;
                                            $("#productversionId").data("kendoComboBox").value(gridData[sel_idx].product_version_id);
                                            //gridData[sel_idx].dealer_cost =data.dealer_cost;
                                            gridData[sel_idx].price =data.dealer_cost;
                                            //////////////////////////////08.06.2017 get stock qty and booked qty//////////////////////
                                            $.ajax({
                                                type: "GET",
                                                url: "@UrlConfig.Action("GetProductStockNBookedQuantity", "Product")",
                                                data: {
                                                    product_id: pId,
                                                    color_id: colId,
                                                    product_version_id: pVersionId
                                                },
                                                dataType: "json",
                                                contentType: "application/json",
                                                success: function (data) {
                                                    console.log("MOHIUDDIN-08.06.2017");
                                                    console.log(data);
                                                    $("#stock_quantity").val(data.stock_quantity);
                                                    $("#booked_quantity").val(data.booked_quantity);
                                                    $("#available_quantity").val(data.available_quantity);
                                                }
                                            });
                                            /////////////////////////////08.06.2017 end///////////////////////////////////////////////
                                        }
                                    });
                                }
                            });
                    }


                    //template for color comboBox
                    function colorDropDownEditor(container, options) {
                        //jQuery('<input required data-text-field="color_name" data-value-field="color_id" data-bind="value:' + options.field + '"/>')
                        jQuery('<input id="colorId" required data-text-field="color_name" data-value-field="color_id" data-bind="value:' + options.field + '"/>')
                            .appendTo(container)

                            .kendoComboBox({
                                autoBind: false,
                                cascadeFrom: "productId",
                                placeholder: "-Select-",
                                dataSource: {
                                    transport: {
                                        read: {
                                            url: "@UrlConfig.Action("GetProductwiseColor", "ProductPriceing")",
                                            type: "GET"
                                        }
                                    }

                                },

                                change: function(e) {
                                    var dataItem = this.dataItem(e.item);
                                    cId = dataItem.color_id;
                                    console.log(dataItem.product_name);
                                    var grid = $("#RequisitionDetailsGrid").data("kendoGrid");
                                    var sel = grid.select();
                                    var sel_idx = sel.index();
                                    var gridData = grid.dataSource.data();
                                    var vId = gridData[sel_idx].product_version_id;
                                    pId = dataItem.product_id;//13.06.2017
                                    gridData[sel_idx].color_id = dataItem.color_id,
                                    gridData[sel_idx].color_name = dataItem.color_name;

                                    $.ajax({
                                        type: "GET",
                                        url: "@UrlConfig.Action("GetProductStockNBookedQuantity", "Product")",
                                        data: {
                                            product_id: pId,
                                            color_id: cId,
                                            product_version_id: vId
                                        },
                                        dataType: "json",
                                        contentType: "application/json",
                                        success: function (data) {
                                            $("#stock_quantity").val(data.stock_quantity);
                                            $("#booked_quantity").val(data.booked_quantity);
                                            $("#available_quantity").val(data.available_quantity);
                                        }
                                    });
                                    //load version dropdown by product && color wise
                                    $("#productversionId").kendoComboBox({
                                        autoBind: true,
                                        placeholder: "--- Select Party ---",
                                        dataTextField: "product_version_name",
                                        dataValueField: "product_version_id",
                                        dataSource: {
                                            type: "json",
                                            transport: {
                                                read: {
                                                    url: "@UrlConfig.Action("GetProductColorwiseVersion", "ProductPriceing")",
                                                    data:{aa:pId,bb:cId}
                                                }
                                            }
                                        },
                                        change: function (e) {

                                            var dataItem = this.dataItem(e.item);
                                            //////////////////////23.01.2017 start//////////////////////
                                            //to get party type, product, color and version wise price
                                            var partyTypeId=($("#party_type_id").val());
                                            $.ajax({
                                                type: "GET",
                                                url: "@UrlConfig.Action("GetProductColorVersionwisePrice", "ProductPriceing")",
                                                data: {
                                                    party_type_id: partyTypeId,
                                                    product_id: pId,
                                                    color_id: cId,
                                                    product_version_id: dataItem.product_version_id
                                                },
                                                dataType: "json",
                                                contentType: "application/json",
                                                success: function(data) {
                                                    gridData[sel_idx].price = data;
                                                    gridData[sel_idx].price_ori = data;
                                                }
                                            });
                                            //////////////////////23.01.2017 end//////////////////////

                                            var grid = $("#RequisitionDetailsGrid").data("kendoGrid");
                                            var sel = grid.select();
                                            var sel_idx = sel.index();
                                            var gridData = grid.dataSource.data();
                                            gridData[sel_idx].product_version_id = dataItem.product_version_id,
                                            gridData[sel_idx].product_version_name = dataItem.product_version_name;
                                        }
                                    });
                                }
                            });
                    }

                    //load all version
                    function productVersionDropDownEditor(container, options) {

                        jQuery('<input id="productversionId" required data-text-field="product_version_name" data-value-field="product_version_id" data-bind="value:' + options.field + '"/>')
                            .appendTo(container)
                            .kendoComboBox({
                                autoBind: true,
                                placeholder: "-Select-",
                                dataSource: {
                                    transport: {
                                        read: {
                                            url: "@UrlConfig.Action("GetAllProductVersionForDropDown", "ProductVersion")",
                                            type: "GET"
                                        }
                                    }

                                },

                                change: function (e) {

                                    var dataItem = this.dataItem(e.item);
                                    var grid = $("#RequisitionDetailsGrid").data("kendoGrid");
                                    var sel = grid.select();
                                    var sel_idx = sel.index();
                                    var gridData = grid.dataSource.data();
                                    gridData[sel_idx].product_version_id = dataItem.product_version_id,
                                    pvIdInVersionChange = gridData[sel_idx].product_version_id;
                                    gridData[sel_idx].product_version_name = dataItem.product_version_name;
                                    $.ajax({
                                        type: "GET",
                                        url: "@UrlConfig.Action("GetProductStockNBookedQuantity", "Product")",
                                        data: {
                                            product_id: pId,
                                            color_id: cId,
                                            product_version_id: pvIdInVersionChange
                                        },
                                        dataType: "json",
                                        contentType: "application/json",
                                        success: function (data) {
                                            console.log("MOHIUDDIN-08.06.2017");
                                            console.log(data);
                                            $("#stock_quantity").val(data.stock_quantity);
                                            $("#booked_quantity").val(data.booked_quantity);
                                            $("#available_quantity").val(data.available_quantity);
                                        }
                                    });

                                }
                            });
                    }

                    //productList Grid---------------------
                    //getRebateAndGiftInfo();

                }
            });
        }

        myFunction();
        //get master and details information----------------

        $("#requisition_date").kendoDateTimePicker({
            animation: {
                close: {
                    effects: "fadeOut zoom:out",
                    duration: 300
                },
                open: {
                    effects: "fadeIn zoom:in",
                    duration: 300
                }
            }
        });
        $("#expected_receiving_date").kendoDatePicker({
            animation: {
                close: {
                    effects: "fadeOut zoom:out",
                    duration: 300
                },
                open: {
                    effects: "fadeIn zoom:in",
                    duration: 300
                }
            }
        });
        $("#credit_term").kendoDatePicker({
            animation: {
                close: {
                    effects: "fadeOut zoom:out",
                    duration: 300
                },
                open: {
                    effects: "fadeIn zoom:in",
                    duration: 300
                }
            }
        });

        $("#btnSaveInvoice").click(function () {
            Loading(true);

            var party_id=$('#party_id').val();
            var amount=$('#amount').val();//item total(invoice)
            var remarks = $('#remarks').val();
            var company_id=$('#company_id').val();
            var credit_limit = $('#credit_limit').val();
            var party_type_id= $('#party_type_id').val();
            var operation_remarks=$('#operation_remarks').val();

            var contact_person_mobile = $('#contact_person_mobile').val();
            var address = $('#address').val();
            var sales_head_recommendation=$('#recommendation').val();
            var amount=$('#amount').val();//15.05.2017

            var RequisitionMasterData = {
                requisition_master_id :'@ViewBag.requisition_master_id',
                party_id: party_id,
                item_total: amount,
                remarks: remarks,
                company_id: company_id,
                credit_limit: credit_limit,
                party_type_id: party_type_id,
                operation_remarks: operation_remarks,
                contact_person_mobile: contact_person_mobile,
                address: address,
                sales_head_recommendation: sales_head_recommendation,
                requisition_amount: amount,//15.05.2017
                created_by: userId,
                updated_by: userId
            };
            // Requisition Details
            var ProductDetailsList = [];
            var productDetailsGrid = $("#RequisitionDetailsGrid").data("kendoGrid").dataSource.data();
            for (var i = 0; i < productDetailsGrid.length; i++) {
                var ProductDetails = {
                    product_category_id: productDetailsGrid[i].product_category_id,
                    product_id: productDetailsGrid[i].product_id,
                    quantity: productDetailsGrid[i].quantity,
                    price: productDetailsGrid[i].price,
                    unit_id: productDetailsGrid[i].unit_id,
                    color_id: productDetailsGrid[i].color_id,
                    brand_id: productDetailsGrid[i].brand_id,
                    line_total: productDetailsGrid[i].line_total,
                    product_version_id: productDetailsGrid[i].product_version_id,
                    is_gift: false,
                    gift_type: ''
                    //is_live_dummy: productDetailsGrid[i].is_live_dummy,
                };
                ProductDetailsList.push(ProductDetails);
            }
            // promotional gift details
            RequisitionDetailsData = [];

            //for (var i = 0; i < _giftList.length; i++) {
            //    var ProductDetails = {
            //        product_category_id: _giftList[i].product_category_id,
            //        product_id: _giftList[i].product_id,
            //        quantity: _giftList[i].gift_quantity,
            //        price: 0, //_giftList[i].price,
            //        unit_id: _giftList[i].unit_id,
            //        color_id: 0, //bcos gift item color is not defined, will defined in delivery
            //        line_total: 0, //_giftList[i].line_total,
            //        brand_id: _giftList[i].brand_id,
            //        is_gift:  true,
            //        gift_type:'Promotional Gift',
            //        is_live_dummy: false
            //    };
            //    RequisitionDetailsData.push(ProductDetails);
            //    ProductDetailsList.push(ProductDetails);//ProductDetailsList have already pushed previous ProductDetails now push another ProductDetails
            //}

            //Sales gift items grid
            //var giftDetailsGrid = $("#giftitemlist").data("kendoGrid").dataSource.data();
            //for (var i = 0; i < giftDetailsGrid.length; i++) {
            //    var giftProductDetails = {
            //        product_category_id: giftDetailsGrid[i].product_category_id,
            //        product_id: giftDetailsGrid[i].product_id,
            //        quantity: giftDetailsGrid[i].quantity,
            //        price: 0,
            //        unit_id: giftDetailsGrid[i].unit_id,
            //        color_id: giftDetailsGrid[i].color_id,
            //        line_total: 0,
            //        brand_id: giftDetailsGrid[i].brand_id,
            //        is_gift: true,
            //        gift_type:'Sales Gift',
            //        is_live_dummy: false
            //    };

            //    //GiftItemData.push(giftProductDetails);
            //    RequisitionDetailsData.push(giftProductDetails);//requisition_details table insert promotional gift and gift item
            //}

            var InvoiceModel = {
                InvoiceMasterData: RequisitionMasterData,
                InvoiceDetailsList: ProductDetailsList,
                //InvoiceRebateData:_rebateList,
                RequisitionDetailsData: RequisitionDetailsData
            };

            $.ajax({
                type: "POST",
                @*url: "@UrlConfig.Action("HOOpsApproval", "Invoice")",*@
                url: "@UrlConfig.Action("PostInvoice", "Invoice")",
                data: JSON.stringify(InvoiceModel),
                dataType: "json",
                contentType: "application/json",
                success: function (data) {
                    Loading(false);
                    if (data.output == "success") {
                        myFunction();
                        swal("Success", data.msg, "success");
                        setTimeout(function() {
                            window.location.href = '/Invoice/Index';
                        }, 2000);

                        return false;
                    } else {
                        swal("Exception", data.msg, "error");
                        return false;
                    }
                }
            });

        });

    });

</script>
